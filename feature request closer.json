{
  "name": "feature request closer",
  "nodes": [
    {
      "parameters": {
        "formId": "gDbZ6P"
      },
      "type": "n8n-nodes-tallyforms.tallyTrigger",
      "typeVersion": 1,
      "position": [
        -336,
        16
      ],
      "id": "b3c5646c-2bcb-4618-b2d1-c8cec76a5393",
      "name": "Tally Trigger",
      "webhookId": "67767f6c-9f65-4f8e-9d55-8b60608244c3",
      "credentials": {
        "tallyApi": {
          "id": "keUoI8kCieXGmmYP",
          "name": "Tally account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "81db54ad-88ad-4159-896e-5d50e606a325",
              "name": "user_name",
              "value": "={{ $json.question_aaaDDD }}",
              "type": "string"
            },
            {
              "id": "4eda0e05-d795-4535-9537-f351c313be52",
              "name": "user_email",
              "value": "={{ $json.question_bbbEEE }}",
              "type": "string"
            },
            {
              "id": "20d22061-2a21-423f-b975-547c466c2883",
              "name": "original_text",
              "value": "={{ $json.question_cccFFF }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -48,
        -32
      ],
      "id": "71ab7fcc-baec-4f93-b64c-8708c313c62f",
      "name": "Data Cleaner"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "feature_requests",
          "mode": "list",
          "cachedResultName": "feature_requests"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        336,
        -16
      ],
      "id": "ac8b325a-d060-4841-bdbb-ca9d82b87cd2",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "yDCZHYUQOT8FnWnU",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "nomic-embed-text:latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        272,
        240
      ],
      "id": "cc79a1c3-d189-4c88-8cfe-4fb46b281218",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "RvORsIVRZ98wrTDU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.original_text }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "user_name",
                "value": "={{ $json.user_name }}"
              },
              {
                "name": "user_email",
                "value": "={{ $json.user_email }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        480,
        192
      ],
      "id": "f302891f-cef2-46ea-b446-bc5ed3964394",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "content": "# ðŸ‘‚ Branch A: The Listener\n**Captures user feedback and stores it.**\n\n### âš™ï¸ How to Configure:\n1. **Tally Trigger:** Connect your form credential.\n2. **Data Cleaner (Important):** Open this node!\n   - Map your form's \"Name\" field to `user_name`\n   - Map your form's \"Email\" field to `user_email`\n   - Map the \"Request\" field to `original_text`\n   \n> **Pro Tip:** This \"Cleaner\" node ensures the rest of the workflow never breaks, even if you change form providers later!",
        "height": 832,
        "width": 1696,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -688,
        -400
      ],
      "typeVersion": 1,
      "id": "c254df45-2882-46f3-90cb-0b2af936414e",
      "name": "Sticky Note4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -496,
        944
      ],
      "id": "0580b1a4-aa58-4656-92bb-fc35827c0db4",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyWeek"
            }
          ]
        },
        "feedUrl": "https://your_blog.url/rss/"
      },
      "type": "n8n-nodes-base.rssFeedReadTrigger",
      "typeVersion": 1,
      "position": [
        -480,
        1120
      ],
      "id": "7e436856-4161-4892-9549-d82b4527fd59",
      "name": "RSS Feed Trigger"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:11434/api/embeddings",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "nomic-embed-text"
            },
            {
              "name": "prompt",
              "value": "={{ $json.feature_text }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        272,
        1040
      ],
      "id": "eb364351-c01f-481d-91c8-771cb601fed2",
      "name": "Generate Embedding (Ollama)"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        832,
        1040
      ],
      "id": "2a72dad3-7e98-49a4-a9dd-6fb0106996a9",
      "name": "Loop Matches"
    },
    {
      "parameters": {
        "resource": "draft",
        "subject": "={{ $json.output.subject }} - to:{{ $('Loop Matches').item.json.user_email }}",
        "message": "={{ $json.output.body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1440,
        1040
      ],
      "id": "ef129caa-2b1e-40ec-8764-7fcb7601f1c0",
      "name": "Create Draft",
      "webhookId": "a9f1e54b-2f71-4d85-ae42-3231ba526e46",
      "credentials": {
        "gmailOAuth2": {
          "id": "Haijz8L1FUuZMn2p",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1168,
        528
      ],
      "id": "62731939-0d79-421d-bc88-17f63f681e4f",
      "name": "Done!"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{ \"subject\": \"...\", \"body\": \"...\" }"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1248,
        1280
      ],
      "id": "aae5f2f5-8647-4d7c-bc9a-5f79a4f1ead6",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "command-r7b:7b-12-2024-q8_0",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1104,
        1312
      ],
      "id": "3dbf7d1e-ffdf-49d9-9238-7a07cd9a280c",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "RvORsIVRZ98wrTDU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "# ðŸ•µï¸ Branch B: The Matchmaker\n**Finds users who asked for *this* specific feature.**\n\n---\n### 1. Dual Triggers\n- **RSS Feed:** Checks your changelog weekly. If you post \"Dark Mode is live,\" it triggers.\n- **Manual:** Great for testing! Click \"Execute\" and type a phrase to test the search.\n\n### 2. The Vector Search\n- **Embedding:** Converts your announcement into numbers (768 dimensions).\n- **HTTP Request:** Sends those numbers to Supabase to find the nearest semantic match.\n  - *Setup:* Update the **URL** in this node to your Supabase Project URL.\n",
        "height": 1360,
        "width": 2432,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -688,
        464
      ],
      "typeVersion": 1,
      "id": "7e8257ee-f8e8-4eb8-86f3-c378495bb815",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# ðŸŽ£ Feature Request Closer\n### Turn old feedback into new revenue.\n\nThis workflow listens for user requests, remembers them, and automatically drafts personal emails when you launch the feature they asked for.\n\n---\n### ðŸ› ï¸ Prerequisites\n1. **Supabase Project:** You need a project with the `vector` extension enabled.\n2. **Local AI (Ollama):** This template uses `nomic-embed-text` (Local) and `command-r` (Local) by default to keep it free, but you can swap for OpenAI easily.\n3. **SQL Setup:** You **MUST** run the SQL script in the note below to create the database structure.\n\n---\n**Created by Ehsan**",
        "height": 480,
        "width": 768
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1520,
        -400
      ],
      "typeVersion": 1,
      "id": "c106371d-2027-4084-bbfa-aab33e6f8813",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## âš ï¸ Run this SQL First!\nOpen your **Supabase SQL Editor** and paste this script to set up the tables and search function.\n\n```sql\n-- 1. Enable Vector Extension\ncreate extension if not exists vector;\n\n-- 2. Create Request Table (Smart Columns)\ncreate table feature_requests (\n  id bigint generated by default as identity primary key,\n  content text,\n  metadata jsonb,\n  embedding vector(768), -- 768 for Nomic, 1536 for OpenAI\n  created_at timestamp with time zone default timezone('utc'::text, now()),\n  user_email text generated always as (metadata->>'user_email') stored,\n  user_name text generated always as (metadata->>'user_name') stored\n);\n\n-- 3. Create Search Function\ncreate or replace function match_feature_requests (\n  query_embedding vector(768),\n  match_threshold float,\n  match_count int\n)\nreturns table (\n  id bigint,\n  user_email text,\n  user_name text,\n  content text,\n  similarity float\n)\nlanguage plpgsql\nas $$\nbegin\n  return query\n  select\n    feature_requests.id,\n    feature_requests.user_email,\n    feature_requests.user_name,\n    feature_requests.content,\n    1 - (feature_requests.embedding <=> query_embedding) as similarity\n  from feature_requests\n  where 1 - (feature_requests.embedding <=> query_embedding) > match_threshold\n  order by feature_requests.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;\n```\n\nâš ï¸ Dimension Warning: This SQL is set up for 768 dimensions (compatible with the local nomic-embed-text model included in the template).\n\nIf you decide to switch the Embeddings node to use OpenAI's text-embedding-3-small, you must change all instances of 768 to 1536 in the SQL script above before running it.",
        "height": 960,
        "width": 768,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1520,
        128
      ],
      "typeVersion": 1,
      "id": "9dfdf6b3-0807-4764-8fe9-765a58441f27",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# âœï¸ The \"Personal\" Touch\n**Drafts a hyper-personalized email.**\n\nThe **AI Agent** receives the user's original request *and* your new feature announcement.\n\nIt writes a unique email connecting the two:\n> \"Hi [Name], remember when you asked for **[Their Request]**? We just launched **[Feature]** which solves exactly that!\"\n\n---\n**Safety First:**\nThe **Gmail** node creates a **DRAFT** only. No emails are sent automatically unless you change the operation to \"Send\".",
        "height": 784,
        "width": 688,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1008,
        1008
      ],
      "typeVersion": 1,
      "id": "8bebe003-97b0-49d0-9761-ca306eb5f0aa",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n# ðŸŽ‰ Mission Accomplished!\n\nIf the workflow reaches here, you have successfully:\n1. Found a user who felt ignored.\n2. Drafted an email showing you listened.\n3. Potentially reduced churn or gained an upsell.\n\n**Next Step:** Check your Gmail Drafts folder! ðŸ“®",
        "height": 432,
        "width": 560,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1136,
        512
      ],
      "typeVersion": 1,
      "id": "de1baa5c-df91-416f-9f01-ce6f8c4a62dd",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5bceab7a-7012-4e90-a16b-ec6b04ca9a6b",
              "name": "description",
              "value": "we lunched dark mode",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        944
      ],
      "id": "cbea51c6-b1ff-48d0-acca-ce03f6c799a7",
      "name": "Lunch description"
    },
    {
      "parameters": {
        "jsCode": "// 1. Get the input data (works for both Manual and RSS)\nconst input = $input.first().json;\n\n// 2. prioritize manual input, then RSS description, then RSS title\nconst text = input.contentSnippet || input.description || input.title || input.first().json.description || input.manual_text;\n\nreturn { feature_text: text };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -16,
        1040
      ],
      "id": "5f9b9399-1392-46e7-b981-de3b37816fe7",
      "name": "Manage input - Code in JavaScript"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://your_link_to.supabase.co/rest/v1/rpc/match_feature_requests",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query_embedding",
              "value": "={{ $json.embedding }}"
            },
            {
              "name": "match_threshold",
              "value": "0.70"
            },
            {
              "name": "match_count",
              "value": "10"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        544,
        1040
      ],
      "id": "75e48ac4-c4ce-4656-b93f-f70c7582fd8f",
      "name": "HTTP Request - Supabase Search",
      "credentials": {
        "supabaseApi": {
          "id": "yDCZHYUQOT8FnWnU",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a helpful product manager.\n\nContext:\n- User: {{ $json.user_name }}\n- They asked for: \"{{ $json.content }}\"\n- We launched: \"{{ $('Lunch description').item.json.description }}\"\n\nWrite a JSON object with a subject line and a short, friendly HTML email body telling them the feature is here.\n\nFormat: { \"subject\": \"...\", \"body\": \"...\" }",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1056,
        1056
      ],
      "id": "a0a236f6-7df4-4a9d-bc4a-8ab3704ae386",
      "name": "AI Agent - Draft text maker",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "Tally Trigger": {
      "main": [
        [
          {
            "node": "Data Cleaner",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Data Cleaner": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "RSS Feed Trigger": {
      "main": [
        [
          {
            "node": "Manage input - Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Lunch description",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Embedding (Ollama)": {
      "main": [
        [
          {
            "node": "HTTP Request - Supabase Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Matches": {
      "main": [
        [
          {
            "node": "Done!",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent - Draft text maker",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Draft": {
      "main": [
        [
          {
            "node": "Loop Matches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent - Draft text maker",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Draft text maker",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent - Draft text maker",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Lunch description": {
      "main": [
        [
          {
            "node": "Manage input - Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manage input - Code in JavaScript": {
      "main": [
        [
          {
            "node": "Generate Embedding (Ollama)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request - Supabase Search": {
      "main": [
        [
          {
            "node": "Loop Matches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Draft text maker": {
      "main": [
        [
          {
            "node": "Create Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "bf000de7-d4f0-4b5f-bc2b-e863726dd91b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e21631593c665e575c87e460dd8681c44b1aaa7afc3347cf8214a1b5119341f4"
  },
  "id": "6rp7vlgjqll5f7KQ",
  "tags": []
}